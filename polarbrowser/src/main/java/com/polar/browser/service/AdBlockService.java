package com.polar.browser.service;import android.app.Service;import android.content.Context;import android.content.Intent;import android.os.IBinder;import android.os.RemoteException;import android.text.TextUtils;import com.polar.browser.JuziApp;import com.polar.browser.adblock.AdFilter;import com.polar.browser.jni.NativeManager;import com.polar.browser.utils.SimpleLog;/** * 广告拦截服务 * @author dpk * */public class AdBlockService extends Service {	public static final String ACTION_BIND = "com.polar.browser.service.adblockservice.action.bind";	private static final String TAG = "AdBlockService";	private static final String SUBSTITUTE_IMG_NAME = "adblock.png";	private Context mContext;	static {		NativeManager.loadLibrary();	}	private void init() {		AdFilter.getInstance().init();	}	@Override	public void onCreate() {		super.onCreate();		mContext = JuziApp.getAppContext();		init();	}	private IAdBlockService.Stub mAdBlockService = new IAdBlockService.Stub() {		@Override		public boolean shouldBlockUrlSync(String mainUrl, String url) {			try {				if (url == null || mainUrl == null) {					return false;				}				return AdFilter.getInstance().shouldBlockUrlSync(mainUrl, url);			} catch (Throwable e) {				SimpleLog.e(TAG, e.toString());				return false;			}		}		@Override		public String getCssAndLocalStorageScript(String host) {			String result = "";			try {				if (host == null) {					return result;				}				return AdFilter.getInstance().getCssAndLocalStorageScript(host);			} catch (Throwable e) {			}			return result;		}		@Override		public void updateRule(String filename) throws RemoteException {			if (!TextUtils.isEmpty(filename)) {				if (filename.equalsIgnoreCase(AdFilter.ADBLOCK_URL_RULE)) {					AdFilter.getInstance().updateAdBlockRules(AdFilter.LIB_URL);				} else if (filename.equalsIgnoreCase(AdFilter.ADBLOCK_CSS_RULE)) {					AdFilter.getInstance().updateAdBlockRules(AdFilter.LIB_CSS_COOKIE);				}			}		}		@Override		public void exit() {			try {				android.os.Process.killProcess(android.os.Process.myPid());				System.exit(1);			} catch (Exception e) {			}		}	};	@Override	public IBinder onBind(Intent intent) {		SimpleLog.d(TAG, "onBind");		return mAdBlockService;	}	@Override	public void onDestroy() {		SimpleLog.d(TAG, "onDestroy");		super.onDestroy();	}}